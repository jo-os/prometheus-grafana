#jinja2: lstrip_blocks: "True"
{{ prometheus_var_config | to_nice_yaml(indent=2) }}
{% if prometheus_node_exporter_group %}
- job_name: node
  scrape_interval: 15s
  metrics_path: /metrics
  static_configs:
  - targets:
{% for server in groups %}
   {% if server | regex_search('web') %}
      - '{{ groups[server] | join("")}}:9100'
   {% endif %}
{% endfor %}
{% endif %}


#global:
#scrape_interval: 15s

#scrape_configs:
#- job_name: 'prometheus'
#   scrape_interval: 5s
#   static_configs:
#      - targets: ["{{ groups['prometheus'] | join('')}}:9090"]

- job_name: 'nginx-log-ex'
  scrape_interval: 15s
  static_configs:
  - targets:
{% for server in groups %}
   {% if server | regex_search('web') %}
      - '{{ groups[server] | join("")}}:4040'
   {% endif %}
{% endfor %}

rule_files:
  - test.yml

alerting:
  alertmanagers:
    - static_configs:
      - targets: 
        - 'localhost:9093'

remote_write:
    - url: "http://127.0.0.1:9201/write"
remote_read:
    - url: "http://127.0.0.1:9201/read"